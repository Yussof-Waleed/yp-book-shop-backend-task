#!/bin/sh
set -e

echo "ğŸ”„ Pre-commit checks starting..."

# Ensure Docker services are running
echo "ğŸ“‹ Checking Docker services..."
if ! docker-compose ps | grep -q "Up"; then
    echo "ğŸš€ Starting Docker services..."
    docker-compose up -d
    echo "â³ Waiting for services to be ready..."
    sleep 10
fi

# Export the external database URL for local testing
export DATABASE_URL="postgres://postgres:postgres@localhost:5434/books_shop"
export REDIS_URL="redis://localhost:6380"

echo "ğŸ§ª Running tests..."
npm run test:run:local

echo "ğŸ” Running linter..."
npm run lint:local

echo "âœ¨ Checking formatting..."
npm run format:check:local

echo "âœ… All pre-commit checks passed!"

# If we get here, all checks passed
echo "âœ… Pre-commit checks passed! Proceeding with commit..."
